(()=>{"use strict";let e=document.getElementById("humanBoard"),t=document.getElementById("robotBoard");const n=document.querySelectorAll(".numberRow"),r=document.querySelectorAll(".letterRow"),o=function(){for(let e=0;e<10;e++)r.forEach((t=>{const n=document.createElement("div");n.classList.add("letterTile");const r=String.fromCharCode(e+65);n.appendChild(document.createTextNode(r)),t.appendChild(n)}))},i=function(){for(let e=0;e<10;e++)n.forEach((t=>{const n=document.createElement("div");n.classList.add("numberTile"),n.appendChild(document.createTextNode(e+1)),t.appendChild(n)}))},a=function(n){for(let n=0;n<10;n++){const n=document.createElement("div");n.classList.add("boardRow");for(let e=0;e<10;e++){const e=document.createElement("div");e.classList.add("boardTile"),n.appendChild(e)}e.appendChild(n),t.appendChild(n.cloneNode(!0))}},s=function(n,r){for(const o in n){const i=n[o];let a;a="robot"===r?Array.from(t.children)[parseInt(i.slice(1)-1)]:Array.from(e.children)[parseInt(i.slice(1)-1)];const s=i.charCodeAt(0)-65;Array.from(a.children)[s].classList.add("sunkTile")}},c=function(n,r){let o;o="robot"===r?Array.from(t.children)[parseInt(n.slice(1)-1)]:Array.from(e.children)[parseInt(n.slice(1)-1)];const i=n.charCodeAt(0)-65,a=Array.from(o.children)[i];a.classList.add("hitTile"),a.textContent="✖"},l=function(n,r){let o;o="robot"===r?Array.from(t.children)[parseInt(n.slice(1)-1)]:Array.from(e.children)[parseInt(n.slice(1)-1)];const i=n.charCodeAt(0)-65,a=Array.from(o.children)[i];a.classList.add("missTile"),a.textContent="⬤"},d=function(){e=document.getElementById("humanBoard"),t=document.getElementById("robotBoard")},u=document.getElementById("infoText"),m=(()=>{let e=!0;return document.addEventListener("click",(t=>{e||(t.stopPropagation(),t.preventDefault())}),!0),{makeHumanTurn:function(t,n){const r=t.parentElement,o=String.fromCharCode(Array.from(r.children).indexOf(t)+65),i=Array.from(r.parentElement.children).indexOf(r)+1,a=n.receiveAttack(o+i);a.split(" ").includes("miss")?l(o+i,"robot"):(c(o+i,"robot"),a.split(" ").includes("sunk")&&(s(n[a.split(" ")[0]].coordinates,"robot"),n.gameOver()&&alert("GAME OVER"))),u.textContent=a,e=!1},makeRobotTurn:function(t){const n=t.findRandomCoordinate(),r=t.receiveAttack(n);r.split(" ").includes("miss")?l(n,"human"):(c(n,"human"),r.split(" ").includes("sunk")&&(s(t[r.split(" ")[0]].coordinates,"human"),t.gameOver()&&alert("GAME OVER"))),u.textContent=r,setTimeout((()=>{e=!0}),0)}}})();function h(e,t){let n;return n="carrier"===e?5:"battleship"===e?4:"destroyer"===e||"submarine"===e?3:2,{boatName:e,coordinates:t,boatLength:n,hitTracker:{},hit:function(e){this.hitTracker[e]="hit"},isSunk:function(){return Object.keys(this.hitTracker).length===this.boatLength}}}const p=["A1","B1","C1","D1","E1","F1","G1","H1","I1","J1","A2","B2","C2","D2","E2","F2","G2","H2","I2","J2","A3","B3","C3","D3","E3","F3","G3","H3","I3","J3","A4","B4","C4","D4","E4","F4","G4","H4","I4","J4","A5","B5","C5","D5","E5","F5","G5","H5","I5","J5","A6","B6","C6","D6","E6","F6","G6","H6","I6","J6","A7","B7","C7","D7","E7","F7","G7","H7","I7","J7","A8","B8","C8","D8","E8","F8","G8","H8","I8","J8","A9","B9","C9","D9","E9","F9","G9","H9","I9","J9","A10","B10","C10","D10","E10","F10","G10","H10","I10","J10"];function f(e){const t=h("carrier",e.carrier),n=h("battleship",e.battleship),r=h("destroyer",e.destroyer),o=h("submarine",e.submarine),i=h("patrolBoat",e.patrolBoat),a=[];return{gameOver:function(){return!!(t.isSunk()&&n.isSunk()&&r.isSunk()&&o.isSunk()&&i.isSunk())},receiveAttack:function(s){return e.carrier.includes(s)?(t.hit(s),t.isSunk()?"carrier sunk":"carrier hit"):e.battleship.includes(s)?(n.hit(s),n.isSunk()?"battleship sunk":"battleship hit"):e.destroyer.includes(s)?(r.hit(s),r.isSunk()?"destroyer sunk":"destroyer hit"):e.submarine.includes(s)?(o.hit(s),o.isSunk()?"submarine sunk":"submarine hit"):e.patrolBoat.includes(s)?(i.hit(s),i.isSunk()?"patrolBoat sunk":"patrolBoat hit"):(a.push(s),"miss")},findRandomCoordinate:function(){const e=p[Math.floor(Math.random()*p.length)];return p.splice(p.indexOf(e),1),e},carrier:t,battleship:n,destroyer:r,submarine:o,patrolBoat:i}}const y=document.getElementById("gameBoards"),E=document.getElementById("humanBoard"),b={carrier:[],battleship:[],destroyer:[],submarine:[],patrolBoat:[]},A=[5,4,3,3,2];let C=0;const k=(()=>{const e=document.createElement("div");e.classList.add("setupButton");const t=e.cloneNode(!0);return{create:function(){y.prepend(e),y.append(t)},remove:function(){e.remove(),t.remove()}}})(),v=(()=>{function e(e,n,r){return new Promise((o=>{e.addEventListener("click",(()=>{const e=t(n,r);if("hasOverlapped"===e[e.length-1])alert("Invalid location...");else if(r+A[C]<11){for(let e=0;e<A[C];e++){const t=String.fromCharCode(r+e+65),o=Array.from(E.childNodes).indexOf(n)+1;Object.values(b)[C].push(t+o),Array.from(n.childNodes)[r+e].classList.add("shipTile")}if(++C>4){const e=E.cloneNode(!0);E.parentNode.replaceChild(e,E),o(b)}}else alert("Invalid location...")})),e.addEventListener("mouseover",(()=>{const e=t(n,r);if(e.length===A[C])for(const t in e)e[t].classList.add("shipTempTile");else{"hasOverlapped"===e[e.length-1]&&e.pop();for(const t in e)e[t].classList.add("invalidTempTile")}})),e.addEventListener("mouseout",(()=>{const e=t(n,r);if(e.length===A[C])for(const t in e)e[t].classList.remove("shipTempTile");else{"hasOverlapped"===e[e.length-1]&&e.pop();for(const t in e)e[t].classList.remove("invalidTempTile")}}))}))}function t(e,t){let n=!1,r=!1;const o=[];for(let i=0;i<A[C];i++){if(!(t+i<10)){r=!0;break}{const r=Array.from(e.childNodes)[t+i];o.push(r),r.classList.contains("shipTile")&&(n=!0)}}return n&&!r&&o.push("hasOverlapped"),o}return{createPlayerShips:function(){return k.create(),new Promise((t=>{document.querySelectorAll(".boardTile").forEach((async n=>{if(n.parentElement.parentElement===E){const r=n.parentElement,o=Array.from(n.parentElement.children).indexOf(n),i=await e(n,r,o);k.remove(),t(i)}}))}))}}})();a(),o(),i(),(async()=>{const e=await v.createPlayerShips();document.getElementById("infoText").textContent="PLAY!",document.getElementById("robotContainer").style.display="",d();const t=f(e),n=f(e);document.querySelectorAll(".boardTile").forEach((e=>{e.addEventListener("click",(()=>{m.makeHumanTurn(e,n),setTimeout((()=>{m.makeRobotTurn(t)}),500)}))}))})()})();